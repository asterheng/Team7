
{% extends "base.html" %}
{% block content %}
<h2>Users</h2>
{% with messages = get_flashed_messages(with_categories=true,
      category_filter=['list_user:ok']) %}
  {% if messages %}
    <ul class="flashes">
      {% for category, message in messages %}
        {% set cat = category.split(':')[-1] %}
        <li class="{{ cat }}">{{ message }}</li>
      {% endfor %}
    </ul>
  {% endif %}
{% endwith %}

<form method="get" class="search-bar" autocomplete="off">
  <input type="text" name="q" placeholder="Search name, email, or profile…" value="{{ q or '' }}">
  <button class="btn primary" type="submit">Search</button>
  {% if q %}
    <a class="btn reset" href="{{ url_for('boundary.list_users') }}">Reset</a>
  {% endif %}
</form>

{% if rows %}
<table class="table">
  <thead>
    <tr><th>ID</th><th>Name</th><th>Email</th><th>Profile</th><th>Suspended</th><th>Actions</th></tr>
  </thead>
  <tbody>
    {% for u, p in rows %}
      <tr>
        <td>{{ u.id }}</td>
        <td>{{ u.name }}</td>
        <td>{{ u.email }}</td>
        <td>{{ p.name }}</td>
        <td>{{ 'Yes' if u.is_suspended else 'No' }}</td>
        <td><a href="{{ url_for('boundary.edit_user', user_id=u.id) }}">Edit</a></td>
      </tr>
    {% endfor %}
  </tbody>
</table>
{% else %}
  <p>No users found{% if q %} for “{{ q }}”{% endif %}.</p>
{% endif %}

{% if pagination %}
<nav class="pager">
  {% if pagination.has_prev %}
    <a href="{{ url_for('boundary.list_users', q=q, page=pagination.prev_num) }}">Prev</a>
  {% endif %}
  <span>Page {{ pagination.page }} / {{ pagination.pages }}</span>
  {% if pagination.has_next %}
    <a href="{{ url_for('boundary.list_users', q=q, page=pagination.next_num) }}">Next</a>
  {% endif %}
</nav>
{% endif %}
<style>
  .flashes{list-style:none;padding:0;margin:1rem 0;text-align:center}
  .flashes li{display:inline-block;padding:.7rem 1rem;border-radius:10px;margin:.25rem}
  .flashes .ok{background:#d1fae5;border:1px solid #10b981;color:#065f46}
  .flashes .err{background:#fee2e2;border:1px solid #ef4444;color:#991b1b}
  .btn{padding:.8rem 1.1rem;border-radius:10px;border:1px solid #cbd5e1;background:#f1f5f9;color:#0f172a;text-decoration:none}
  .btn.primary{background:linear-gradient(135deg,#2563eb,#1d4ed8);border:none;color:#fff;font-weight:600}
  .btn.primary:hover{filter:brightness(1.06)}
</style>
{% endblock %}